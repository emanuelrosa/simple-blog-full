$(".loadingcreateuser").css("display", "none"); $('#msgauthor').css('display', 'none'); function myFacebookLogout(){FB.logout(function(response){}); }function myFacebookLogin(){$(".loadingcreateuser").css("display", "block"); FB.login(function(response){if (response.status === 'connected'){FB.api('/me', {fields:'id,name,email'}, function(response){var formURL = './author/action/authors.php'; $.ajax({url:formURL, method:"POST", data:{action:"loginauthorfacebook", inputfacebook_id:response.id, inputname:response.name, inputperfil:"", inputemail:response.email}, dataType:"html", success:function(msg){var msg = msg.split("|"); if (msg[0] === "OK"){window.location.href = "./author/"; } else{$("#msgauthor").css("display", "block"); $('#msgauthor').fadeIn(500); $('#msgauthor').html('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><i class="fa fa-warning"></i> Desculpe, aconteceu algo de errado, atualize a página ou tente mais tarde.</div>'); }$(".loadingcreateuser").css("display", "none"); }}); }); }}); }function checkLoginState(){FB.getLoginStatus(function(response){if (response.status === 'connected'){document.getElementById('btn-login-face').innerHTML = '<a href="#" class="btn btn-primary" style="width: 100%" onclick="myFacebookLogin()"><span class="fa fa-facebook"></span> &nbsp;&nbsp;|&nbsp;&nbsp;Login via Facebook</a>'; } else if (response.status === 'not_authorized'){document.getElementById('btn-login-face').innerHTML = '<a href="#" class="btn btn-primary" style="width: 100%" onclick="myFacebookLogin()"><span class="fa fa-facebook"></span> &nbsp;&nbsp;|&nbsp;&nbsp;Login via Facebook</a>'; } else{document.getElementById('btn-login-face').innerHTML = '<a href="#" class="btn btn-primary" style="width: 100%" onclick="myFacebookLogin()"><span class="fa fa-facebook"></span> &nbsp;&nbsp;|&nbsp;&nbsp;Login via Facebook</a>'; }}); }function createUserByFacebook(){$(".loadingcreateuser").css("display", "block"); FB.login(function(response){if (response.status === "connected"){FB.api('/me', {fields:'id,name,email'}, function(response){var formURL = './author/action/authors.php'; $.ajax({url:formURL, method:"POST", data:{action:"newauthor", inputfacebook_id:response.id, inputname:response.name, inputperfil:"", inputemail:response.email}, dataType:"html", success:function(msg){var msg = msg.split("|"); if (msg[0] === "OK"){window.location.href = "./author/"; } else if (msg[0] === "CAD"){$("#msgauthor").css("display", "block"); $('#msgauthor').fadeIn(500); $('#msgauthor').html('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><i class="fa fa-warning"></i> Autor já cadastrado, entre no botão de login via Facebook.</div>'); } else{$("#msgauthor").css("display", "block"); $('#msgauthor').fadeIn(500); $('#msgauthor').html('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><i class="fa fa-warning"></i> Desculpe, aconteceu algo de errado, tente mais tarde.</div>'); }$(".loadingcreateuser").css("display", "none"); }}); }); } else{$("#msgauthor").css("display", "block"); $('#msgauthor').fadeIn(500); $('#msgauthor').html('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><i class="fa fa-warning"></i> Você deve aceitar compartilhar informações, para criar uma nova conta!</div>'); $(".loadingcreateuser").css("display", "none"); }}, {scope:'email'}); }window.fbAsyncInit = function(){FB.init({appId:'1430791703884484', cookie:true, xfbml:true, version:'v2.2'}); checkLoginState(); };